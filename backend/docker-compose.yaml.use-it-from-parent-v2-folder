services:

  nginx:
    image: nginx

    volumes:
      - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf
    ports:
      - 8080:80

    env_file:
      - v3/src/environments/.env.docker 

    depends_on:
      - v3

    environment:
      - NGINX_PORT=80
      

  redis:
    image: redis:alpine
    hostname: redis
    command: redis-server
    labels:
      NAME: redis
      

  v3_workers: 
    build:
      context: v3/.
      dockerfile: Dockerfile.v3_workers 
    
    env_file:
      - installation.env
      - v3/src/environments/.env.docker 
      - credetials.env

    command:  sleep 99999 #/app/start_workers.sh

    volumes:
      - type: bind
        source: v3.txt
        target: /tmp/v3.txt
        
#    volumes:
#    
#      - './v3/v3.txt:/tmp/v3.txt'
#      
#      - './v3/src:/app'      
#      - '/var/log/impresa/v3_workers:/app/logs'
#      - '/tmp/sloba.txt:/sloba-ttt'
#      #- './v3/installation.env:/app/environments/installation.env'
#      - '${PWD}/v3/installation.env:/app/environments/installation.env'

    extra_hosts:
      - "host.docker.internal:host-gateway"

  v3:
  

    build:
      context: v3/.
      dockerfile: Dockerfile.v3  

    env_file:
      - installation.env
      - v3/src/environments/.env.docker 
      - credetials.env

    command: /app/start.sh

    volumes:
      - './v3/src:/app'      
      - '/var/log/impresa/v3_services:/app/logs'

    extra_hosts:
      - "host.docker.internal:host-gateway"

  
